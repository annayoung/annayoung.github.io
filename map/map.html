
<!DOCTYPE html>
<html>
  <head>
     <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
     <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
     <link href='iframe_style.css' rel='stylesheet' type='text/css'>
     <script type="text/javascript" src="jquery.js"></script>
     <script type="text/javascript" src="slide.js"></script>
  </head>

  <body>
    
    <div id="map"></div>
    <div id="tool-tip"></div>
    <div id="legends">   
      
      <div id="legend_countries" class="legend">
        <p class="legend_title">PM<sub>2.5</sub> LEVELS</p>
        <span class="country_leftest">0.03</span>
        <span class="country_middle">49.92</span>
        <span class="country_rightest">153</span><br>
        <aside class="colors">


          <div style="background-color:#fff74b;"></div>
          <div style="background-color:#ffd72d;"></div>
          <div style="background-color:#FFaa00;"></div>
          <div style="background-color:#FF8200;"></div>
          <div style="background-color:#FF5a00;"></div>
          <div style="background-color:#FF3200;"></div>
          <div style="background-color:#f50000;"></div>
          <div style="background-color:#c30000;"></div>
          <div style="background-color:#870000;"></div>
          <div style="background-color:#4e0000;"></div>

          <div style="background-color:#80CC99;"></div>
          <div style="background-color:#4DB870;"></div>
          <div style="background-color:#33AD5C;"></div>
          <div style="background-color:#19A347;"></div>
          <div style="background-color:#009933;"></div>
          <div style="background-color:#008A2E;"></div>
          <div style="background-color:#007A29;"></div>
          <div style="background-color:#006B24;"></div>
          <div style="background-color:#005C1F;"></div>
          <div style="background-color:#004C1A;"></div>

          <!--<div style="background-color:#CCEBD6;"></div>
          <div style="background-color:#4DB870;"></div>
          <div style="background-color:#009933;"></div>
          <div style="background-color:#005C1F;"></div>
          <div style="background-color:#002E0F;"></div>-->



          <!--<div style="background-color:#a0d080;"></div>
          <div style="background-color:#90c070;"></div>
          <div style="background-color:#8AB66C;"></div>
           <div style="background-color:#80b060;"></div>
           <div style="background-color:#70a050;"></div>

           <div style="background-color:#609040;"></div>
           <div style="background-color:#508030;"></div>
           <div style="background-color:#407020;"></div>
           <div style="background-color:#306010;"></div>
           <div style="background-color:#203000;"></div>-->


          
        </aside>
        <div id="legend_cities" style="display:none">
        </aside>
          <span class="city_leftest">2</span><span class="city_rightest">153</span>
          <p class="city_title">CITY PM<sub>2.5</sub> LEVELS</p><br>
        </div>
      </div>
    </div>

    <div id="slide_out_info">
      <a class="handle" href="#">
        <span id="rotated_text">Map Info</span>
      </a>
      <div class="content">
        <h1>Air pollution trends in countries and cities</h1> <br>
          In 2012, the <a href="http://www.who.int/mediacentre/news/releases/2014/air-pollution/en/" target="_blank">World Health Organization (WHO)</a> estimates 7 million people died - one in eight deaths - due to air pollution exposure. This map shows both national and city-level exposures to fine particulate matter or PM<sub>2.5</sub>, which is an air pollutant with human health consequences.<br><br>


        City-level data (represented as points in the map) for around 1,600 cities in 91 countries from 2008 to 2013 are provided in the <a href="http://www.who.int/phe/health_topics/outdoorair/databases/AAP_database_methods_2014.pdf?ua=1" target="_blank">WHO's Ambient Air Pollution database</a>. These values for cities generally represent annual averaged data from a single or multiple air monitoring stations.<br><br> 

        The national data (represented by the country shading) are from the 2014 <a href="http://www.epi.yale.edu/" target="_blank">Environmental Performance Index (EPI)</a>. Researchers led by <a href="http://myweb.dal.ca/adonkela/main.swf" target="_blank">Aaron van Donkelaar</a> at Dalhousie University used satellite data to estimate ground-level exposures to fine particulate matter (PM<sub>2.5</sub>). These data indicate longer term exposures to PM<sub>2.5</sub> and are based on a three-year rolling average of data from 1998 to 2012. Read more about how these data were developed <a href="http://epi.yale.edu/our-methods/air-quality" target="_blank">here</a>.<br><br>


        <h1><b>ABOUT THE ENVIRONMENTAL PERFORMANCE INDEX (EPI)</b></h1><br>
        The <a href="http://www.epi.yale.edu/" target="_blank">Environmental Performance Index</a> is a biennial global ranking of how well countries perform on high-priority environmental issues. It is a joint project of the <a href="http://envirocenter.yale.edu/" target="_blank">Yale Center for Environmental Law & Policy</a> and the <a href="http://ciesin.columbia.edu/" target="_blank">Center for International Earth Science Information Network</a> at The Earth Institute, Columbia University. 
        <br><br><br>
        <span>Created by <a href="http://spinsomewebs.com/" target="_blank">Pedro Cunha</a> and <a href="http://www.dmitrypavluk.com" target="_blank">Dmitry Pavluk</a> using CartoDB <br>with help from <a href="https://twitter.colorsm/andrewxhill" target="_blank">Andrew Hill</a>, Anna Young, and Diego Torres Quintanilla</span>
      </div>
    </div>

    <div id="header_container">
      <div id="header">
        <div id="layer_selector" class="cartodb-infobox">
          <ul>
            <ul class="countries_label">&nbsp;Countries: <br></ul>
            <li data="2000">2000</li>
            <li data="2001">2001</li>
            <li data="2002">2002</li>
            <li data="2003">2003</li>
            <li data="2004">2004</li>
            <li data="2005">2005</li>
            <li data="2006">2006</li>
            <li data="2007">2007</li>
            <li data="2008">2008</li>
            <li data="2009">2009</li>
            <li data="2010">2010</li>
            <li data="2011">2011</li>
            <li data="2012" class="selected">2012</li>  
          </ul>

        </div>
        <div id="layer_selector2" class="cartodb-infobox">
          <p data="pm_2_5" id="show_cities">Show Cities</p> 
        </div>
      </div>
     </div>     
        

  </body>
  <script type="cartocss/html" id="cities">
  /*City Styles*/

  

#who_georeferenced_clean_v2{
  marker-fill-opacity: 0.8;
  marker-line-color: #FFF;
  marker-line-width: 1.5;
  marker-line-opacity: 1;
  marker-width: 10;
  //marker-fill: #FFFFB2;
  marker-fill: #F7F7F7;
  marker-allow-overlap: true;
}

/*var colors = [
    "#fff74b", "#ffd72d", "#FFaa00", "#FF8200", "#FF5a00", "#FF3200"
    , "#f50000", "#c30000", "#870000", "#4e0000"
    , "#a0d080", "#90c070", "#8AB66C", "#80b060"
    , "#70a050", "#609040", "#508030", "#407020"
    , "#306010", "#203000"
  ];
#who_georeferenced_clean_v2 [ pm_2_5 <= 154] {
  marker-fill: colors[19];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 146.5] {
  marker-fill: colors[18];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 139] {
  marker-fill: colors[17];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 131.5] {
  marker-fill: colors[16];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 124] {
  marker-fill: colors[15];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 116.5] {
  marker-fill: colors[14];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 109] {
  marker-fill: colors[13];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 101.5] {
  marker-fill: colors[12];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 94] {
  marker-fill: colors[11];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 86.5] {
  marker-fill: colors[10];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 79] {
   marker-fill: colors[9];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 71.5] {
   marker-fill: colors[8];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 64] {
   marker-fill: colors[7];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 56.5] {
   marker-fill: colors[6];
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 49] {
   marker-fill: colors[5];
 #who_georeferenced_clean_v2 [ pm_2_5 <= 41.5] {
    marker-fill: colors[4];
 #who_georeferenced_clean_v2 [ pm_2_5 <= 34] {
 marker-fill: colors[3];
 #who_georeferenced_clean_v2 [ pm_2_5 <= 26.5] {
 marker-fill: colors[2];
 #who_georeferenced_clean_v2 [ pm_2_5 <= 19] {
 marker-fill: colors[1];
 #who_georeferenced_clean_v2 [ pm_2_5 <= 8.5] {
 marker-fill: colors[0];*/

/*#who_georeferenced_clean_v2 [ pm_2_5 <= 154] {
  marker-fill: #4e0000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 140] {
  marker-fill: #870000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 125] {
  marker-fill: #c30000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 110] {
  marker-fill: #f50000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 90] {
  marker-fill: #FF3200;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 69] {
  marker-fill: #FF5a00;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 55] {
  marker-fill: #FF8200;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 41] {
  marker-fill: #FFaa00;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 28] {
  marker-fill: #ffd72d;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 15] {
  marker-fill: #fff74b;
}*/


/*#who_georeferenced_clean_v2 [ pm_2_5 <= 154] {
   marker-fill: #4e0000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 140] {
   marker-fill: #870000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 130] {
   marker-fill: #c30000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 120] {
   marker-fill: #f50000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 110] {
   marker-fill: #FF3200;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 100] {
   marker-fill: #FF5a00;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 90] {
   marker-fill: #FF8200;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 80] {
   marker-fill: #FFaa00;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 70] {
   marker-fill: #ffd72d;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 60] {
   marker-fill: #fff74b;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 50] {
   marker-fill: #002E0F;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 40] {
   marker-fill: #005C1F;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 30] {
   marker-fill: #009933;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 20] {
   marker-fill: #4DB870;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 10] {
   marker-fill: #CCEBD6;
}*/


#who_georeferenced_clean_v2 [ pm_2_5 <= 154] {
   marker-fill: #004C1A;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 146.3] {
   marker-fill: #005C1F;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 138.6] {
   marker-fill: #006B24;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 130.9] {
   marker-fill: #007A29;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 123.2] {
   marker-fill: #008A2E;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 115.5] {
   marker-fill: #009933;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 107.8] {
   marker-fill: #19A347;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 100.1] {
   marker-fill: #33AD5C;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 92.4] {
   marker-fill: #4DB870;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 84.7] {
   marker-fill: #80CC99;
}

#who_georeferenced_clean_v2 [ pm_2_5 <= 49.92] {
   marker-fill: #4e0000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 32.54] {
   marker-fill: #870000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 25.17] {
   marker-fill: #c30000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 15.17] {
   marker-fill: #f50000;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 10.85] {
   marker-fill: #FF3200;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 9.15] {
   marker-fill: #FF5a00;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 8.15] {
   marker-fill: #FF8200;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 6.06] {
   marker-fill: #FFaa00;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 4.62] {
   marker-fill: #ffd72d;
}
#who_georeferenced_clean_v2 [ pm_2_5 <= 2.98] {
   marker-fill: #fff74b;
}


  </script>

   <script type="cartocss/html" id="pm25_na">
   /*Country Styles*/

#pm25_na{
  polygon-fill: #FFFFB2;
  polygon-opacity: 0.8;
  line-color: #FFF;
  line-width: 1;
  line-opacity: 1;
}

/*#pm25_na [ {0} <= 49.92] {
   polygon-fill: #4e0000;
}
#pm25_na [ {0} <= 32.54] {
   polygon-fill: #870000;
}
#pm25_na [ {0} <= 25.17] {
   polygon-fill: #c30000;
}
#pm25_na [ {0} <= 15.17] {
   polygon-fill: #f50000;
}
#pm25_na [ {0} <= 10.85] {
   polygon-fill: #FF3200;
}
#pm25_na [ {0} <= 9.15] {
   polygon-fill: #FF5a00;
}
#pm25_na [ {0} <= 8.15] {
   polygon-fill: #FF8200;
}
#pm25_na [ {0} <= 6.06] {
   polygon-fill: #FFaa00;
}
#pm25_na [ {0} <= 4.62] {
   polygon-fill: #ffd72d;
}
#pm25_na [ {0} <= 2.98] {
   polygon-fill: #fff74b;
}*/

/*//ORIGINAL
#pm25_na [ {0} <= 154] {
   polygon-fill: #4e0000;
}
#pm25_na [ {0} <= 140] {
   polygon-fill: #870000;
}
#pm25_na [ {0} <= 125] {
   polygon-fill: #c30000;
}
#pm25_na [ {0} <= 110] {
   polygon-fill: #f50000;
}
#pm25_na [ {0} <= 90] {
   polygon-fill: #FF3200;
}
#pm25_na [ {0} <= 69] {
   polygon-fill: #FF5a00;
}
#pm25_na [ {0} <= 55] {
   polygon-fill: #FF8200;
}
#pm25_na [ {0} <= 41] {
   polygon-fill: #FFaa00;
}
#pm25_na [ {0} <= 28] {
   polygon-fill: #ffd72d;
}
#pm25_na [ {0} <= 15] {
   polygon-fill: #fff74b;
}*/

/*#pm25_na [ {0} <= 154] {
   polygon-fill: #4e0000;
}
#pm25_na [ {0} <= 140] {
   polygon-fill: #870000;
}
#pm25_na [ {0} <= 130] {
   polygon-fill: #c30000;
}
#pm25_na [ {0} <= 120] {
   polygon-fill: #f50000;
}
#pm25_na [ {0} <= 110] {
   polygon-fill: #FF3200;
}
#pm25_na [ {0} <= 100] {
   polygon-fill: #FF5a00;
}
#pm25_na [ {0} <= 90] {
   polygon-fill: #FF8200;
}
#pm25_na [ {0} <= 80] {
   polygon-fill: #FFaa00;
}
#pm25_na [ {0} <= 70] {
   polygon-fill: #ffd72d;
}
#pm25_na [ {0} <= 60] {
   polygon-fill: #fff74b;
}
#pm25_na [ {0} <= 50] {
   polygon-fill: #002E0F;
}
#pm25_na [ {0} <= 40] {
   polygon-fill: #005C1F;
}
#pm25_na [ {0} <= 30] {
   polygon-fill: #009933;
}
#pm25_na [ {0} <= 20] {
   polygon-fill: #4DB870;
}
#pm25_na [ {0} <= 10] {
   polygon-fill: #CCEBD6;
}*/



#pm25_na [ {0} <= 154] {
   polygon-fill: #004C1A;
}
#pm25_na [ {0} <= 146.3] {
   polygon-fill: #005C1F;
}
#pm25_na [ {0} <= 138.6] {
   polygon-fill: #006B24;
}
#pm25_na [ {0} <= 130.9] {
   polygon-fill: #007A29;
}
#pm25_na [ {0} <= 123.2] {
   polygon-fill: #008A2E;
}
#pm25_na [ {0} <= 115.5] {
   polygon-fill: #009933;
}
#pm25_na [ {0} <= 107.8] {
   polygon-fill: #19A347;
}
#pm25_na [ {0} <= 100.1] {
   polygon-fill: #33AD5C;
}
#pm25_na [ {0} <= 92.4] {
   polygon-fill: #4DB870;
}
#pm25_na [ {0} <= 84.7] {
   polygon-fill: #80CC99;
}

#pm25_na [ {0} <= 49.92] {
   polygon-fill: #4e0000;
}
#pm25_na [ {0} <= 32.54] {
   polygon-fill: #870000;
}
#pm25_na [ {0} <= 25.17] {
   polygon-fill: #c30000;
}
#pm25_na [ {0} <= 15.17] {
   polygon-fill: #f50000;
}
#pm25_na [ {0} <= 10.85] {
   polygon-fill: #FF3200;
}
#pm25_na [ {0} <= 9.15] {
   polygon-fill: #FF5a00;
}
#pm25_na [ {0} <= 8.15] {
   polygon-fill: #FF8200;
}
#pm25_na [ {0} <= 6.06] {
   polygon-fill: #FFaa00;
}
#pm25_na [ {0} <= 4.62] {
   polygon-fill: #ffd72d;
}
#pm25_na [ {0} <= 2.98] {
   polygon-fill: #fff74b;
}



    </script>

    <script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script> 
     
     <script>
          $('#layer_selector li').click(function() {        
            $('#layer_select li').addClass('selected');
          });
          var col1 = 'pm25_2000';
          var col2 = '';
          var country = 'country';
          var city = 'city_station';
          var pm = 'pm_2_5';

          //Formats the columns for us into css
          String.prototype.format = (function (i, safe, arg) {
            function format() {
                var str = this,
                    len = arguments.length + 1;

                for (i = 0; i < len; arg = arguments[i++]) {
                    safe = typeof arg === 'object' ? JSON.stringify(arg) : arg;
                    str = str.replace(RegExp('\\{' + (i - 1) + '\\}', 'g'), safe);
                }
                return str;
            }

            //format.native = String.prototype.format;
            return format;
            
        })();






      // create layer selector
    function main() {
        var map = new L.Map('map', { 
          zoomControl: true,
          legend:true,
          center: [43, 0],
          zoom: 2,
          scrollWheelZoom: true,
          searchControl: true
        });

        

        // create our layers
        cartodb.createLayer(map, {
          user_name: 'dmonay',
          type: 'cartodb',
          sublayers: [{
            sql: "SELECT * FROM bathymetry_layers",
            cartocss: "#bathymetry_layers{ polygon-fill: #598cdb;polygon-opacity: 0.2;line-color: #FFF;line-width: 0;line-opacity: 1;}"
            },{
            sql: "SELECT * FROM pm25_na",
            cartocss: $('#pm25_na').html().format('pm25_2000'),
            interactivity: "cartodb_id, the_geom, pm25_2000, pm25_2001, pm25_2002, pm25_2003, pm25_2004, pm25_2005, pm25_2006, pm25_2007, pm25_2008, pm25_2009, pm25_2010, pm25_2011, pm25_2012, country"
            },{
            sql: "SELECT * FROM who_georeferenced_clean_v2",
            cartocss: $('#cities').html().format('city_station'),
            interactivity: "city_station, pm_2_5, country"
            }]

        }).done(function(layer) {
          // add the layers to our map 
          map.addLayer(layer);
          sublayer_country = layer.getSubLayer(1);
          sublayer_country.setInteraction(true);
          sublayer_city = layer.getSubLayer(2);
          sublayer_city.setInteraction(true);
          createSelector(sublayer_country);
          createSelector(sublayer_city);
          sublayer_city.hide();

          //create infowindow
            sublayer_city.infowindow.set('template', $('#infowindow_template').html()).on('error', function() {
            console.log("some error occurred");
          });
          
          //Make Tool-tip follow the mouse.
          var event = function(e){
                  $('#tool-tip').css({
                     left:  e.pageX,
                     top:   e.pageY
                  });
              };
//Retrieve data to the tooltip on countries
          sublayer_country.on('featureOver', function(e, pos, latlng, data) {
            $('#tool-tip').html('<p>'  +data[country]+'<br>'+ data[col1] + '&mu;g/m<sup>3</sup></p>');
            $(document).bind('mousemove', event);
            $('#tool-tip').show();
            
          });
            sublayer_country.on('featureOut', function(e, pos, latlng, data) {
           //Make the tooltip go away when off countries
            $('#tool-tip').hide();
            $(document).unbind('mousemove', event, false);
          });
//Retrieve data to the tooltip on cities
            sublayer_city.on('featureOver', function(e, pos, latlng, data) {
            $('#tool-tip').html('<p>'  +data[city]+', '+data[country]+  '<br>'+data[pm]+ '&mu;g/m<sup>3</sup></p>');
            $(document).bind('mousemove', event);
            $('#tool-tip').show();
            
          });
            sublayer_city.on('featureOut', function(e, pos, latlng, data) {
           //Make the tooltip go away when off cities
            $('#tool-tip').hide();
            $(document).unbind('mousemove', event, false);
          });

            

            
    });
  }

      
      window.onload = main;

/*Selection process          ------------------------------------------                       */
     
     var styles = {}, selectedStyle;
      // create layer selector
      function createSelector(layer) {

        var $options = $('#layer_selector li');
        $options.click(function(e) {
          // get the area of the selected layer
          var $li = $(e.target);
          var year = $li.attr('data');

          // deselect all and select the clicked one
          $options.removeClass('selected');
          $li.addClass('selected');


          col1 = 'pm25_' + year;
          var style = $('#pm25_na').html().format(col1);
            layer.setCartoCSS(style);
            sublayer_city.hide();


          $('#show_cities').removeClass('shown');
          $("#show_cities").text("Show Cities");
          $("#legend_cities").hide();
          $("#legend_countries").removeClass("cities_label");

         $(".cartodb-legend:nth-child(1)").show();

          }); 
        }


      $("#show_cities").on("click", function(){
        if ($("#show_cities").hasClass('shown'))
        {
          sublayer_city.hide();
          var year = $('#layer_selector li.selected').attr('data');
          col1 = 'pm25_' + year;
          //$("#legend_cities").hide();
           $("#show_cities").removeClass('shown');
          $("#show_cities").text("Show Cities");

          //$("#legend_countries").removeClass("cities_label");
        }
        else
        {
          //Set the column to the city_station from our cities table
          col2 = 'city_station';
          //create a local variable named style and convert our cities script above to html and run the format function defined above to render some CSS.
           var style = $('#cities').html().format(col2);
          //Attached the CSS to the layer
          sublayer_city.setCartoCSS(style);
           sublayer_city.show();

          //Hide legend on click
          //$("#legend_cities").show();
          $("#show_cities").addClass('shown');
          $("#show_cities").text("Hide Cities");
          
          //$("#legend_countries").addClass("cities_label");
        }
      });

  
         //have the info tab slide out
        $('#slide_out_info').tabSlideOut({
          tabHandle: '.handle',                     //class of the element that will become your tab
          //Optionally can be set using css
          height: '110px',                     //height of tab image           //Optionally can be set using css
          width: '30px',                       //width of tab image            //Optionally can be set using css
          tabLocation: 'right',                      //side of screen where tab lives, top, right, bottom, or left
          speed: 400,                               //speed of animation
          action: 'click',                  //options: true makes it stick(fixed position) on scroll
      });

    </script>

</script>
</html>